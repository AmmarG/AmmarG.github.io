<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
</head>

<body>
    <script src="bower_components/d3/d3.min.js"></script>
    <script src="bower_components/topojson/topojson.min.js"></script>
    <script src="bower_components/datamaps/dist/datamaps.usa.min.js"></script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Start Box -->
    <div class="box us-map">
        <div class="head">
            <h2 style="font-size: 38px; padding: 10px 10px 20px 10px;">الإنتخابات الأميركية 2016</h2>
        </div>
        <div class="content">
            <div class="arena">
                <div id="elections-map"></div>
                <div style="clear: both; overflow: hidden; text-align: center; font-weight: bold; font-size: 18px; color: #333; padding-bottom: 20px;">
                    <div style="width: 30%; float: right;">
                        <img src="https://vid.alarabiya.net/images/2016/10/05/0746af9e-6a4c-438e-9ff4-705f8903214b/0746af9e-6a4c-438e-9ff4-705f8903214b.jpg" style="width: 40%; height:30%; -webkit-border-radius: 30%;
-moz-border-radius: 100px;
border-radius: 100px;" alt="هيلاري كلينتون" />
                        <div style="padding-top: 5px;">عدد الأصوات</div>
                        <div id="demlbl" style="color: #2196f3; background: url('https://vid.alarabiya.net/images/2016/10/05/5f339040-87e5-415d-82d6-ca5459ab4543/5f339040-87e5-415d-82d6-ca5459ab4543.png') right no-repeat; width: 100px; margin: 0 auto; font-family: Tahoma;"></div>
                    </div>
                    <div style="width: 40%; float: right; font-size: 28px; padding-top: 10%; background: url('https://vid.alarabiya.net/images/2016/10/05/115f24d2-cbf6-446f-aec1-8bcbbb346422/115f24d2-cbf6-446f-aec1-8bcbbb346422.png') center 25% no-repeat;">غير محدد
                        <div id="nalbl" style="color: #ffbd27; font-size: 18px; font-family: Tahoma; padding-top: 5px;"></div>
                    </div>
                    <div style="width: 30%; float: left;">
                        <img src="https://vid.alarabiya.net/images/2016/10/05/d92ee2a7-8c4b-4f11-8c0d-03ea358c9d99/d92ee2a7-8c4b-4f11-8c0d-03ea358c9d99.jpg" style="width: 40%; height:30%; -webkit-border-radius: 100px;
-moz-border-radius: 100px;
border-radius: 100px;" alt="دونالد ترامب" />
                        <div style="padding-top: 5px;">عدد الأصوات</div>
                        <div id="replbl" style="color: #ff5252; font-family: Tahoma;"></div>
                    </div>
                </div>
                <style>
                    .box.us-map svg {
                        direction: ltr !important;
                    }
                    .datamaps-legend {
                        right: 0;
                        left: auto;
                    }
                    .datamaps-legend dt,
                    .datamaps-legend dd {
                        float: right;
                        margin: 0;
                    }
                    .datamaps-legend dt {
                        font-family: Tahoma;
                        font-size: 11px;
                        font-weight: normal;
                        line-height: 150%;
                    }
                    .datamaps-legend dd {
                        margin: 0 3px 0 15px;
                        width: 15px;
                        height: 15px;
                    }
                    .us-map {
                        background: #eefcff;
                    }
                    .us-map .head h2 {
                        font-size: 60px;
                        color: #73337d;
                        line-height: 100%;
                        padding: 0 10px 30px 0;
                    }
                </style>
                <script>
                    var electionsMap = new Datamap({
                        scope: 'usa',
                        element: document.getElementById('elections-map'),
                        responsive: true,
                        geographyConfig: {
                            popupTemplate: function(geography, data) {
                                return data && "<div dir='rtl' class='hoverinfo'><strong>" + data.arabicName + "</strong><hr>الأصوات الانتخابية: " + data.electoralVotes + "</strong></div>";
                            },
                            highlightOnHover: true,
                            highlightBorderColor: 'rgba(0, 0, 0, 0.8)',
                            highlightBorderWidth: 1,
                            highlightFillColor: '#fcfbb3',
                            borderColor: '#FDFDFD',
                        },
                        dataUrl: 'http://api.alarabiya.net/uselections/mapdata',
                        dataType: 'json',
                        fills: {
                            defaultFill: '#ffc61c',
                            'ديمقراطي': '#2196f3',
                            'جمهوري': '#ff5252',
                            'ميل ديمقراطي': '#92d4fc',
                            'ميل جمهوري': '#ff9d99',
                            'غير محدد': '#ffc61c'
                        },
                        done: function(datamap) {
                            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
                                if (datamap.options.data[geography.id].path != "#") {
                                    window.location.href = datamap.options.data[geography.id].path;
                                }
                            });
                        }
                    });

                     // Calculation Totals
                    $.getJSON('http://api.alarabiya.net/uselections/mapdata', function(countall) {
                        var NAcount = 0;
                        var DEMcount = 0;
                        var SDEMcount = 0;
                        var REPcount = 0;
                        var SREPcount = 0;
                        for (var key in countall) {
                            if (countall[key].fkCandidate == "NA") {
                                NAcount += countall[key].electoralVotes
                            } else if (countall[key].fkCandidate == "DEM") {
                                DEMcount += countall[key].electoralVotes
                            } else if (countall[key].fkCandidate == "SDEM") {
                                SDEMcount += countall[key].electoralVotes
                            } else if (countall[key].fkCandidate == "REP") {
                                REPcount += countall[key].electoralVotes
                            } else if (countall[key].fkCandidate == "SREP") {
                                SREPcount += countall[key].electoralVotes
                            }
                        }

                        console.log("NAcount - " + NAcount);
                        console.log("DEMcount - " + (DEMcount + SDEMcount));
                        console.log("REPcount - " + (REPcount + SREPcount));

                        document.getElementById("replbl").innerHTML = REPcount + SREPcount;
                        document.getElementById("demlbl").innerHTML = DEMcount + SDEMcount;
                        document.getElementById("nalbl").innerHTML = NAcount;
                    });
                     //--------------------------------


                    electionsMap.labels();
                    electionsMap.legend();
                    d3.select(window).on('resize', function() {
                        electionsMap.resize();
                    });
                </script>
            </div>
        </div>
    </div>
</body>

</html>