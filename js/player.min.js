!function(t,e,s,i){"use strict";function u(e,s){this.element=e,this.settings=t.extend({},l,s),this._defaults=l,this._name=n,this.init()}var n="musicPlayer",l={playlistItemSelector:"li",autoPlay:!1,volume:80,loop:!1,timeSeparator:" / ",playerAbovePlaylist:!0,infoElements:["title","artist"],elements:["artwork","information","controls","progress","time","volume"],timeElements:["current","duration"],controlElements:["backward","play","forward","stop"],onLoad:function(){},onPlay:function(){},onPause:function(){},onStop:function(){},onFwd:function(){},onRew:function(){},volumeChanged:function(){},seeked:function(){},trackClicked:function(){},onMute:function(){}},o="ontouchstart"in e,a=o?"touchstart":"mousedown",r=o?"touchmove":"mousemove",h=o?"touchcancel":"mouseup";t.extend(u.prototype,{init:function(){var e="",s="",i="",n="",l="",o="",a="",r="",d="",h="",u="",c="",m="",f="",v="",p="",g="",y="",A="",w="",C=this;for(var H in this.settings.elements)if("volume"==this.settings.elements[H])o="<div class='volume'><div class='volume-btn' title='Volume'></div><div class=' volume-adjust'><div><div></div></div></div></div>",l+=o;else if("progress"==this.settings.elements[H])a="<div class='progressbar'><div class='bar-loaded' ></div><div class='bar-played'></div></div>",l+=a;else if("artwork"==this.settings.elements[H])r="<div class='cover'><span class='play-icon'></span></div>",l+=r;else if("information"==this.settings.elements[H]){u="-1"!=t.inArray("title",this.settings.infoElements)?"<div class='title'></div>":" ",c="-1"!=t.inArray("artist",this.settings.infoElements)?"<div class='artist'></div>":" ";for(var E in this.settings.infoElements)"title"==this.settings.infoElements[E]?n+=u:"artist"==this.settings.infoElements[E]&&(n+=c);i="<div class='info' >"+n+"</div>",l+=i}else if("time"==this.settings.elements[H]){g="-1"!=t.inArray("current",this.settings.timeElements)?"<div class='time-current'></div>":" ",y="-1"!=t.inArray("duration",this.settings.timeElements)?"<div class='time-duration'></div>":" ",A="<div class='time-separator'>"+this.settings.timeSeparator.replace(/\s/g,"&nbsp;")+"</div>";for(var E in this.settings.timeElements)1==E&&(s+=A),"current"==this.settings.timeElements[E]?s+=g:"duration"==this.settings.timeElements[E]&&(s+=y);d="<div class='timeHolder'>"+s+"</div>",l+=d}else if("controls"==this.settings.elements[H]){m="-1"!=t.inArray("backward",this.settings.controlElements)?"<div class='rew'></div>":" ",f="-1"!=t.inArray("forward",this.settings.controlElements)?"<div class='fwd'></div>":" ",v="-1"!=t.inArray("stop",this.settings.controlElements)?"<div class='stop'></div>":" ",p="-1"!=t.inArray("play",this.settings.controlElements)?"<div class='play'></div><div class='pause'></div>":" ";for(var E in this.settings.controlElements)"backward"==this.settings.controlElements[E]?e+=m:"play"==this.settings.controlElements[E]?e+=p:"forward"==this.settings.controlElements[E]?e+=f:"stop"==this.settings.controlElements[E]&&(e+=v);h="<div class='controls'>"+e+"</div>",l+=h}w=t("<div class='player' >"+l+"</div>"),this.settings.playerAbovePlaylist?t(w).insertBefore(t(this.element).find(".playlist")):t(w).insertAfter(t(this.element).find(".playlist")),this.playlistItemSelector=this.settings.playlistItemSelector,this.playlistHolder=t(this.element).children(".playlist"),this.playerHolder=t(this.element).children(".player"),this.song="",this.theBar=this.playerHolder.find(".progressbar"),this.barPlayed=this.playerHolder.find(".bar-played"),this.barLoaded=this.playerHolder.find(".bar-loaded"),this.timeCurrent=this.playerHolder.find(".time-current"),this.timeDuration=this.playerHolder.find(".time-duration"),this.timeSeparator=this.settings.timeSeparator,this.volumeInfo=this.playerHolder.find(".volume"),this.volumeButton=this.playerHolder.find(".volume-btn"),this.volumeAdjuster=this.playerHolder.find(".volume-adjust > div"),this.volumeValue=this.settings.volume/100,this.volumeDefault=0,this.trackInfo=this.playerHolder.find(".info"),this.coverInfo=this.playerHolder.find(".cover"),this.controlsInfo=this.playerHolder.find(".controls"),this.controlPlay=t(this.controlsInfo).find(".play"),this.controlPause=t(this.controlsInfo).find(".pause"),this.controlStop=t(this.controlsInfo).find(".stop"),this.controlFwd=t(this.controlsInfo).find(".fwd"),this.controlRew=t(this.controlsInfo).find(".rew"),this.cssClass={playing:"playing",mute:"mute"},/iPad|iPhone|iPod/.test(navigator.userAgent)&&t(this.volumeInfo).hide(),this.initAudio(t(this.playlistHolder.children(this.playlistItemSelector+":first-child"))),this.song.volume=this.volumeValue,this.timeDuration.html("&hellip;"),this.timeCurrent.text(this.secondsToTime(0)),t(this.controlPlay).click(function(t){t.preventDefault(),C.playAudio()}),t(this.controlPause).click(function(t){t.preventDefault(),C.stopAudio(),C.settings.onPause()}),t(this.controlFwd).click(function(e){e.preventDefault(),C.stopAudio();var s=t(C.playlistHolder).find(C.playlistItemSelector+".active").next();0==s.length&&(s=t(C.playlistHolder).find(C.playlistItemSelector+":first-child")),C.loadNewSong(s),C.playAudio(),C.settings.onFwd()}),t(this.controlRew).click(function(e){e.preventDefault(),C.stopAudio();var s=t(C.playlistHolder).find(C.playlistItemSelector+".active").prev();0==s.length&&(s=t(C.playlistHolder).find(C.playlistItemSelector+":last-child")),C.loadNewSong(s),C.playAudio(),C.settings.onRew()}),t(this.controlStop).click(function(t){t.preventDefault(),C.stopAudio(),C.song.currentTime=0,C.settings.onStop()}),t(this.playlistHolder).find(this.playlistItemSelector).click(function(e){e.preventDefault(),C.stopAudio(),C.loadNewSong(t(this)),C.playAudio(),C.settings.trackClicked()})},secondsToTime:function(t){var e=Math.floor(t/3600),s=Math.floor(t%3600/60),i=Math.ceil(t%3600%60);return(0==e?"":e>0&&e.toString().length<2?"0"+e+":":e+":")+(s.toString().length<2?"0"+s:s)+":"+(i.toString().length<2?"0"+i:i)},adjustVolume:function(t){var e=o?t.originalEvent.touches[0]:t;this.song.volume=Math.abs((e.pageX-this.volumeAdjuster.offset().left)/this.volumeAdjuster.width())},adjustCurrentTime:function(t){var e=o?t.originalEvent.touches[0]:t;this.song.currentTime=Math.round(this.song.duration*(e.pageX-this.theBar.offset().left)/this.theBar.width())},initAudio:function(e){var s=e.children("a:first-child").attr("href"),i=e.text(),n=e.attr("data-cover"),l=e.attr("data-artist"),o=this;t(this.trackInfo).children(".title").text(i),t(this.trackInfo).children(".artist").text(l),t(this.coverInfo).css("background-image","url("+n+")"),this.song=new Audio(s),this.song.load(),this.song.addEventListener("loadeddata",function(){t(o.timeDuration).html(o.secondsToTime(this.duration)),t(o.volumeAdjuster).find("div").width(100*this.volume+"%"),o.volumeDefault=this.volume},!1),this.song.addEventListener("progress",function(){t(o.barLoaded).width(this.buffered.end(0)/this.duration*100+"%")}),this.song.addEventListener("timeupdate",function(){t(o.timeCurrent).text(o.secondsToTime(this.currentTime)),t(o.barPlayed).width(this.currentTime/this.duration*100+"%")}),this.song.addEventListener("volumechange",function(){Number(Math.round(100*this.volume+"e1")+"e-1")<=.4&&(this.volume=0),t(o.volumeAdjuster).find("div").width(100*this.volume+"%"),this.volume>0&&o.playerHolder.hasClass(o.cssClass.mute)&&o.playerHolder.removeClass(o.cssClass.mute),this.volume<=0&&!o.playerHolder.hasClass(o.cssClass.mute)&&o.playerHolder.addClass(o.cssClass.mute),o.volumeValue=this.volume}),this.song.addEventListener("ended",function(){o.settings.autoPlay?o.autoPlayNext():(o.playerHolder.removeClass(o.cssClass.playing),t(o.controlPlay).removeClass("hidden"),t(o.controlPause).removeClass("visible"))}),t(this.volumeButton).on("click",function(){return t(o.playerHolder).hasClass(o.cssClass.mute)?(t(o.playerHolder).removeClass(o.cssClass.mute),o.song.volume=o.volumeDefault):(t(o.playerHolder).addClass(o.cssClass.mute),o.volumeDefault=o.song.volume,o.song.volume=0,o.settings.onMute()),!1}),t(this.volumeAdjuster).on(a,function(t){o.adjustVolume(t),o.volumeAdjuster.on(r,function(t){o.adjustVolume(t)}),o.settings.volumeChanged()}).on(h,function(){o.volumeAdjuster.unbind(r)}),t(this.theBar).on(a,function(t){o.adjustCurrentTime(t),o.theBar.on(r,function(t){o.adjustCurrentTime(t)})}).on(h,function(){o.theBar.unbind(r),o.settings.seeked()}),t(this.playlistHolder).children(o.playlistItemSelector).removeClass("active"),e.addClass("active"),this.settings.onLoad(),this.settings.autoPlay&&this.playAudio()},playAudio:function(){this.song.play(),this.playerHolder.addClass(this.cssClass.playing),"-1"!=t.inArray("controls",this.settings.elements)&&"-1"!=t.inArray("play",this.settings.controlElements)&&(t(this.controlPlay).addClass("hidden"),t(this.controlPause).addClass("visible")),this.settings.onPlay()},stopAudio:function(){this.song.pause(),this.playerHolder.removeClass(this.cssClass.playing),"-1"!=t.inArray("controls",this.settings.elements)&&"-1"!=t.inArray("play",this.settings.controlElements)&&(t(this.controlPlay).removeClass("hidden"),t(this.controlPause).removeClass("visible"))},autoPlayNext:function(){this.stopAudio();var e=t(this.playlistHolder).children(this.playlistItemSelector+".active").next();0==e.length&&this.settings.loop?(e=t(this.playlistHolder).children(this.playlistItemSelector+":first-child"),this.loadNewSong(e),this.playAudio()):0==!e.length&&(this.loadNewSong(e),this.playAudio())},loadNewSong:function(t){this.volumeValue=this.song.volume,this.initAudio(t),this.song.volume=this.volumeValue,this.volumeAdjuster.find("div").width(100*this.volumeValue+"%"),this.barPlayed.width(0),this.barLoaded.width(0)}}),t.fn[n]=function(e){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new u(this,e))})}}(jQuery,window,document);